<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->


<% unless notice.blank? %>
<div class="alert alert-success" role="alert">
<p id="notice"><%= notice %></p>
</div>
<% end %>

<div style='width: 100%;margin-top: -1.55%;'>
  <div id="map" style='width: 100%; height: 400px;'></div>
</div>

<script type="text/javascript">
  
  handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: "map"}}, function(){
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});

</script>

<div id="boomsearch" padding-top="9px" style="padding-top: 9px">
      <form id="searchForm" action="/search/?q=" method="get">
      <input type="search" placeholder="Search" name="q" >
      </form>
</div>

<p>
  <strong>User: </strong>
  <%= @feeding.user_id %>
</p>

<p>
  <strong>Date: </strong>
  <%= @feeding.date %>
</p>

<p>
  <strong>Time: </strong>
  <%= @feeding.time %>
</p>

<p>
  <strong>Place: </strong>
  <%= @feeding.place %>
</p>

<p>
  <strong>Pax limit: </strong>
  <% if @feeding.pax_limit.nil? || @feeding.pax_limit == 0 %>
  No Limit
  <% elsif @feeding.feeders.where(paystatus: :authorized).count >= @feeding.pax_limit %>
  Sorry, Feeding Event Is Full
  <% else %>
  <%= @feeding.pax_limit.to_s %>
  <% end %>
</p>

<p>
  <strong>Price:</strong>
  <% if @feeding.price.nil? || @feeding.price == 0 %>
  FREE! JUST JOIN! 
  <% else %>
  RM <%= @feeding.price %>
  <% end %>
</p>

<p>
  <strong>Feeding pics:</strong>
  <% @feeding.feeding_pics.each do |feeding_pic| %>
  <p><%= image_tag feeding_pic.url(:full).to_s %></p>
  <% end %>
</p>


<table style="width:100%">
  <thead>
    <tr>
      <th class="lead" style="text-align: center">No.</th>
      <th class="lead" style="text-align: center">Name</th>
      <th class="lead" style="text-align: center">Status</th>
    </tr>
  </thead>

  <tbody>
    <% @feeding_feeders.each.with_index do |feeder, index| %>
      <tr>
        <td class="lead" style="text-align: center"><%= index + 1 %></td>
        <% if feeder.user.profile_pic.blank? && feeder.user.name.blank? %>
        <td class="lead" style="text-align: center"><%= link_to "#{feeder.user.email}", user_path(feeder.user.id) %></td>
        <% elsif feeder.user.profile_pic.blank? && feeder.user.name.blank? == false %>
        <td class="lead" style="text-align: center"><%= link_to "#{feeder.user.name}", user_path(feeder.user.id) %></td>
        <% elsif feeder.user.profile_pic.blank? == false && feeder.user.name.blank? %>
        <td class="lead" style="text-align: center"><%= image_tag feeder.user.profile_pic.url(:thumb).to_s, class: "img-rounded" %>   <%= link_to "#{feeder.user.email}", user_path(feeder.user.id) %></td>
        <% else %>
        <td class="lead" style="text-align: center"><%= image_tag feeder.user.profile_pic.url(:thumb).to_s, class: "img-rounded" %>   <%= link_to "#{feeder.user.name}", user_path(feeder.user.id) %></td>
        <% end %>
        <td class="lead" style="text-align: center"><span class="label label-success"> JOINED </span></td>
      </tr>
    <% end %>
  </tbody>
</table>





<br>

<%= link_to 'Edit', edit_feeding_path(@feeding) %> |
<%= link_to 'Back', feedings_path %>

<% if @feeding.feeders.where(:user_id => current_user.id).blank? %>

  <% if @feeding.pax_limit.nil? || @feeding.pax_limit == 0 %>
  |
  <%= link_to 'Join', feeding_feeders_path(@feeding), method: :post, data:  {no_turbolink: true}%>
  <% elsif @feeding.feeders.where(paystatus: :authorized).count >= @feeding.pax_limit %>
  Sorry, Feeding Event Is Full
  <% else %>
  |
  <%= link_to 'Join', feeding_feeders_path(@feeding), method: :post, data:  {no_turbolink: true}%>
  <% end %>

<% end %>
